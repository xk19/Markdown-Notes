## Structure-to-Shape Aortic 3-D Deformation Reconstruction for Endovascular Interventions

- **背景**：目前导管在血管内的干预仅依靠X射线透视的二维图像，缺乏3维信息，对主动脉3维可视化有助于指导医生操作导管
- **目的**：术中实时可视化主动脉3D形状，形状重建
- **方法**：融合术前3D模型+两个术中图像，进行重建3D形变。首先重建主动脉3D中心线，按照由粗到细的方式，重建3D形状。从 荧光透视图像中提取语义特征，并计算距离场以有效计算 3-D-2-D 非刚性对应关系。采用非线性最小二乘优化来解决中心线和形状的变形。
- **要点**
  - 主动脉术前3D模型来自于术前CT/MRI，该模型是静态的，不可用于术中
  - 任务主要工作是解决非刚性重建问题，分类两类，一类是结构（骨架或中心线）重建，另一类是3D重建
  - 求解非刚性迭代最近点（ICP）方法重建主动脉3D形状，用符号距离场（SDF）替代来提高计算速度（前面的工作）
  - 重建主动脉3D中心线首先需要从荧光透视图像中提取2D中心线，传统方式使用骨架化和U-Net网络，但是都不容易，本文使用两个荧光透视图像进行分割的网络（CenterlineNet）
  - 提取的中心线之间的间隙用插值填充，然后根据2D中心线构建加权距离场（DF），并相应地恢复3D中心线。然后，使用重建的 3D 中心线作为测量来使血管的 3D 形状预变形。使用该预变形的 3D 形状作为输入数据，最终根据从每个术中图像中提取的主动脉边界像素构建的 SDF 来估计主动脉 3D 变形。
  - 边界像素提取基于U-Net，并使用了改进的摩尔领域追踪方法（PMNT）
- **分割与特征提取**
	- 中心线分割
		- 一种是用U-Net网络直接分割出主动脉中心线，但是由于中心线是抽象的概念，且相对于背景图占比较少，该方法分割中心线的表现不好。
		- 另一种是先分割出主动脉的轮廓，再进行骨架化提取中心线，该方法对于重叠结构鲁棒性差。
		- 该文章提出了一种新的中心线分割网络，叫做CenterlineNet，该网络基于手术中的两个图像一起进行分割，网络由双共享权重编码器-解码器组成
			- 由于数据高度不平衡（中心线像素占比太少），分类器（二分类分割问题）容易忽略前景，导致局部最小值，本文中使用骰子损失函数（Dice loss）来处理这种不平衡数据。
			- 优化器采用随机梯度下降法（SGD）
	- 中心线提取
		- 首先对CenterlineNet的输出进行二值化，然后进行骨架化，得到二维中心线的像素，但是该像素可能被分成几段，因此使用三次样条插值来填补，并计算所有点的权重，存储在距离场（DF）中，因此有了权重距离场，用于恢复3D中心线形变
		- 实验表明使用权重时中心线重建的精度更高
	- 轮廓提取
		- 过往的工作中，先使用U-Net进行分割，计算出二值轮廓，然后用MNT法从轮廓中提取出边界像素，但是MNT方法比较耗时，它首先从二值图像计算起点（例如，从一个角开始循环遍历每一列，直到命中前景像素），然后通过围绕 MN （摩尔边界）迭代提取边界像素沿着固定的方向搜索，直到再次到达起点。换句话说，该算法不是在并行过程中运行（边界像素被逐一提取）。此外，它忽略了内孔。需要额外的洞搜索，这进一步增加了计算时间。
		- 本文中为了提高特征点提取速度，充分利用GPU上的并行计算，对MNT进行改进，得到了PMNT算法，该算法在原文中给出了伪代码
- **3D-2D非刚性对应**
	- 为了根据提取的特征计算主动脉的3D中心线和3D形状的变形场，需要计算3D-2D非刚性的对应关系
	- 首先将手术前的3D数据投影到每幅图像上，然后根据最近距离计算投影点与特征之间的匹配度。投影方式采用近似透视投影的正交投影
	- 结合几何信息，采用基于距离场（DF）的匹配方式来计算3D-2D中心线和顶点像素的非刚性对应关系，DF旨在快速计算3D和2D中心线之间的匹配程度
	- **中心线匹配**：在计算对应关系时，将术前 3-D 中心线投影到每个 DF (4上，并且可以直接从构建的 DF 读取距离和梯度。法线向量用于删除错误的匹配，如果投影中心线的法线与对应特征的法线之间的角度大于阈值，则丢弃匹配。用几何信息（法线向量）来剔除错误的匹配
	- **顶点轮廓匹配**：与上述类似，只是增加了符号（SDF）
- **形状重构**
	- 完成特征提取和对应3D-2D后，进行3D变形重建，分为三步：3D中心线重建、3D形状的初始重建、主动脉3D变形的细化
	- 对于主动脉 3-D 中心线和 3-D 形状，变形时根据embedded deformation (ED)  graph进行估计的，主要思想时使用局部仿射变换的加权平均来描述变形。
	- 算法
- **实验验证**
	- 使用模型和患者数据集对所提出的框架的有效性进行验证
		- 一是二维血管中心线的分割和提取
		- 二是主动脉变形重构方面的改进与现有结果的比较
	- 使用硅胶主动脉模型进行评估
		- 手动改变模型的形状，做了三次实验
		- 血管外表面由开源3D 分割软件ITK-SNAP分割，并由开源的三维几何处理软件MeshLab进行处理，以形成术前3D模型
		- 对于轮廓分割，采用U-Net网络进行分割
		- 对于二维中心线分割，标签使用地面真实投影生成，3D中心线投影到平面上，并近似为像素坐标的整数，插值后获得连续的二维标签。且为提高训练性能，对曲线进行膨胀，变成矩形块
	- 评价指标
		- 用平均对称距离来评估提取的中心线与地面真实标签之间的误差
		- 点到平面距离和点到线的距离来评估主动脉3D形状和3D中心线的重建精度
	- 2D中心线分割与提取
		- 消融实验---不同方法进行提取的
			- 使用第一个数据集进行训练，包含由 CT 数据渲染的来自不同观察方向的 650 个模拟图像/标签；使用第二个训练集微调，包含206个真实X射线图像/标签；采用不同的数据增强技术（随机翻转、对比度、饱和度调整）
			- 实验中为了考虑数据不平衡，采用的是加权交叉熵，而不是骰子函数
			- 表1给出了消融实验的数据结果，分别做了骨架化、U-Net分割和本文的CenterlineNet实验，其中没有重叠时骨架化也可以正确提取，但是当血管发生部分遮挡时，精度会急剧下降
			- 给出了有遮挡和无遮挡情况下所提出方法与骨架化的实验对比图
		- 消融实验---标签的不同膨胀方式
			- 对中心线使用2\*2到10\*10不同大小的方块进行膨胀
			- 给出了提取误差的箱线图，表明6\*6的效果最好
	- 2D轮廓的提取
		- 使用的U-Net网络进行分割，并采用了PMNT方法提取轮廓
		- 给出了PMNT算法与常规的OpenCV内置轮廓提取算法的计算时间对比图，表明采用PMNT方法比现有的方法更加快，OPenCV平均计算时间约2.41毫秒/图像，而PMNT平均计算时间约0.19毫秒/图像
	- 3D主动脉重建
		- 使用加权点来填充中心线的间隙，并存储权重
		- 给出了有和没有插值点权重的中心线重建误差，并做了量化，表明有权重时中心线重建精度更高
		- 有了重建的3D中心线，血管的3D形状就会相应地预变形，预变形结果接近实际3D变形
		- 给出了旧方法、新方法分别进行轮廓匹配和3D重建的结果



​                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
